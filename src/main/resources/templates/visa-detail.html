<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${visa.name} + ' (' + ${visa.subclass} + ') â€“ Required Documents | VisaGuide.au'">Visa Detail</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ‡¦ðŸ‡º</text></svg>">
</head>
<body>

<!-- Header (simplified for detail page) -->
<header class="site-header" style="padding: 1.5rem 0 2rem;">
    <div class="header-inner">
        <div class="header-top">
            <span class="flag">ðŸ‡¦ðŸ‡º</span>
            <a href="/" class="logo">Visa<span>Guide</span>.au</a>
        </div>
    </div>
</header>

<main class="container">

    <!-- Back Button -->
    <a href="/" class="back-btn">&#8592; All Visa Categories</a>

    <!-- Detail Hero Card -->
    <div class="detail-hero">
        <div class="detail-hero-header">
            <span class="detail-icon" th:utext="${visa.categoryIcon}"></span>
            <div class="detail-titles">
                <div class="detail-badge" th:text="${visa.subclass}"></div>
                <h1 class="detail-name" th:text="${visa.name}"></h1>
                <span class="category-tag" th:text="${visa.category}"></span>
            </div>
        </div>
        <p class="detail-desc" th:text="${visa.description}"></p>

        <div class="detail-info-grid">
            <div class="info-card">
                <span class="info-label">Processing Time</span>
                <span class="info-value" th:text="${visa.processingTime}"></span>
            </div>
            <div class="info-card">
                <span class="info-label">Visa Validity</span>
                <span class="info-value" th:text="${visa.validity}"></span>
            </div>
            <div class="info-card">
                <span class="info-label">Application Fee</span>
                <span class="info-value" th:text="${visa.cost}"></span>
            </div>
            <div class="info-card">
                <span class="info-label">Total Documents</span>
                <span class="info-value" th:text="${visa.documents.size()} + ' items'"></span>
            </div>
        </div>
    </div>

    <!-- Content Grid -->
    <div class="content-grid">

        <!-- LEFT: Document Checklist -->
        <div>
            <div class="card-section">
                <h2 class="card-section-title">
                    &#128203; Required Documents Checklist
                </h2>

                <!-- Progress Bar -->
                <div class="progress-wrap" id="progressWrap">
                    <div class="progress-header">
                        <span class="progress-label">Documents Gathered</span>
                        <span class="progress-count" id="progressCount">0 / <span th:text="${visa.documents.size()}"></span></span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Document Items -->
                <div class="doc-list">
                    <div th:each="doc, iter : ${visa.documents}" class="doc-item">
                        <div class="doc-checkbox"
                             th:id="'cb-' + ${iter.index}"
                             th:attr="data-index=${iter.index}"
                             onclick="toggleCheck(this)"
                             title="Mark as gathered">
                        </div>
                        <div class="doc-info">
                            <div class="doc-name">
                                <span th:text="${doc.name}"></span>
                                <span th:if="${doc.mandatory}" class="badge-mandatory">Required</span>
                                <span th:unless="${doc.mandatory}" class="badge-optional">Optional</span>
                            </div>
                            <div class="doc-desc" th:text="${doc.description}"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notes -->
            <div th:if="${!visa.notes.isEmpty()}" class="card-section" style="margin-top: 1.5rem;">
                <h2 class="card-section-title">&#128161; Important Notes</h2>
                <ul class="notes-list">
                    <li th:each="note : ${visa.notes}" th:text="${note}"></li>
                </ul>
            </div>

            <!-- Disclaimer -->
            <div class="disclaimer">
                <strong>Disclaimer:</strong> Document requirements may vary depending on your individual circumstances,
                country of origin, and the most recent policy updates from the Australian Department of Home Affairs.
                Always verify requirements at
                <a href="https://immi.homeaffairs.gov.au" target="_blank" rel="noopener">immi.homeaffairs.gov.au</a>
                before lodging your application.
            </div>
        </div>

        <!-- RIGHT: Eligibility + Summary -->
        <div>
            <!-- Eligibility Requirements -->
            <div class="card-section">
                <h2 class="card-section-title">&#9989; Eligibility Requirements</h2>
                <ul class="eligibility-list">
                    <li th:each="point : ${visa.eligibilityPoints}" th:text="${point}"></li>
                </ul>
            </div>

            <!-- Document Summary -->
            <div class="card-section" style="margin-top: 1.5rem;">
                <h2 class="card-section-title">&#128196; Document Summary</h2>
                <div style="display:flex; flex-direction:column; gap:0.75rem;">
                    <div style="display:flex; justify-content:space-between; align-items:center; padding:0.75rem; background:rgba(239,68,68,0.06); border-radius:8px; border-left:3px solid var(--danger);">
                        <span style="font-size:0.9rem; font-weight:600; color:var(--text);">Required Documents</span>
                        <span style="font-size:1.1rem; font-weight:800; color:var(--danger);" th:text="${visa.mandatoryCount}"></span>
                    </div>
                    <div style="display:flex; justify-content:space-between; align-items:center; padding:0.75rem; background:rgba(100,116,139,0.06); border-radius:8px; border-left:3px solid var(--text-muted);">
                        <span style="font-size:0.9rem; font-weight:600; color:var(--text);">Optional Documents</span>
                        <span style="font-size:1.1rem; font-weight:800; color:var(--text-muted);" th:text="${visa.optionalCount}"></span>
                    </div>
                    <div style="display:flex; justify-content:space-between; align-items:center; padding:0.75rem; background:rgba(26,79,160,0.06); border-radius:8px; border-left:3px solid var(--primary);">
                        <span style="font-size:0.9rem; font-weight:600; color:var(--text);">Total Documents</span>
                        <span style="font-size:1.1rem; font-weight:800; color:var(--primary);" th:text="${visa.documents.size()}"></span>
                    </div>
                </div>
            </div>

            <!-- Apply Link -->
            <div class="card-section" style="margin-top:1.5rem; text-align:center;">
                <h2 class="card-section-title" style="justify-content:center;">&#127758; Ready to Apply?</h2>
                <p style="font-size:0.875rem; color:var(--text-muted); margin-bottom:1rem; line-height:1.6;">
                    Submit your application online through the Australian Government's ImmiAccount portal.
                </p>
                <a href="https://immi.homeaffairs.gov.au/visas/getting-a-visa/visa-listing"
                   target="_blank"
                   rel="noopener"
                   style="display:inline-block; padding:0.85rem 1.5rem; background:var(--primary); color:white; border-radius:var(--radius-sm); font-weight:700; font-size:0.9rem; transition:background 0.2s;">
                    Apply on DOHA Website &#8594;
                </a>
            </div>

            <!-- Print Button -->
            <div style="margin-top:1rem; text-align:center;">
                <button onclick="window.print()"
                        style="padding:0.65rem 1.25rem; background:var(--surface); border:1px solid var(--border); border-radius:var(--radius-sm); font-size:0.875rem; font-weight:500; color:var(--text-muted); cursor:pointer; width:100%;">
                    &#128424; Print Checklist
                </button>
            </div>
        </div>

    </div><!-- end content-grid -->

</main>

<!-- Footer -->
<footer class="site-footer">
    <p>
        <strong>VisaGuide.au</strong> &mdash; Not affiliated with the Australian Government &middot;
        Data sourced from <a href="https://immi.homeaffairs.gov.au" target="_blank" rel="noopener">immi.homeaffairs.gov.au</a>
    </p>
</footer>

<script>
    const totalDocs = document.querySelectorAll('.doc-item').length;

    function updateProgress() {
        const checked = document.querySelectorAll('.doc-checkbox.checked').length;
        const pct = totalDocs > 0 ? Math.round((checked / totalDocs) * 100) : 0;
        document.getElementById('progressFill').style.width = pct + '%';
        document.getElementById('progressCount').innerHTML =
            checked + ' / ' + totalDocs;
    }

    function toggleCheck(el) {
        el.classList.toggle('checked');
        if (el.classList.contains('checked')) {
            el.innerHTML = '&#10003;';
        } else {
            el.innerHTML = '';
        }
        updateProgress();
    }
</script>

<script>
    (function () {
        var ws;
        function connect() {
            ws = new WebSocket('ws://localhost:35729/livereload');
            ws.onmessage = function (msg) {
                var data = JSON.parse(msg.data);
                if (data.command === 'reload') location.reload();
            };
            ws.onclose = function () {
                setTimeout(function () { location.reload(); }, 2000);
            };
        }
        connect();
    })();
</script>
</body>
</html>
